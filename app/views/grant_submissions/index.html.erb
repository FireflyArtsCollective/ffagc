<ol class="breadcrumb">
  <li>Grant Submissions</li>
  <li class="active">Index</li>
</ol>

<div class="alert alert-info">
  <% if any_submit_open? %>
    <p><%= render partial: 'grants/sentence_list', locals: { process_type: 'submission', grant_names: active_submit_names } %></p>
    <% if can? :new, GrantSubmission %>
    <p><%= link_to "Submit Grant Proposal", new_grant_submission_path, class: 'btn btn-primary' %></p>
    <% end%>
  <% else %>
    No submissions open at this time.
  <% end %>
</div>

<% if @celebrate_funded %>
  <div class="alert alert-success text-center">
    <p class="lead">OMG you've been funded!</p>
  </div>
<% end %>

<% unless @grant_submissions.empty? %>
  <table class="table table-striped">
    <thead>
    <tr>
      <th>Submission Title</th>
      <th>Grant</th>
      <th>Funding</th>
      <th></th>
    </tr>
    </thead>
    <tbody>
  <% @grant_submissions.each do |gs| %>
    <tr>
      <td><%= gs.name %></td>
      <td><%= gs.grant&.name %> Grant</td>
      <td>
        <%= render partial: 'funding_table', locals: { grant_submission: gs }%>
      <td>
        <div class="btn-toolbar">
          <div class="btn-group pull-right">
            <% if can? :edit, gs %>
            <%= link_to "Edit", edit_grant_submission_path(id: gs.id), class: 'btn btn-default' %>
            <% end %>
            <%= link_to "View", grant_submission_path(id: gs.id), class: 'btn btn-default' %>
          </div>
          <div class="btn-group pull-right">
            <% if grant_submission_funded?(gs.id) %>
              <%= link_to "Generate Contract", generate_contract_grant_submission_path(gs, format: 'pdf'), method: :post, class: 'btn btn-success btn-inline' %>
            <% elsif submission_has_questions?(gs.id) %>
              <%= link_to "Answer Questions", discuss_grant_submission_path(gs), class: 'btn btn-primary' %>
            <% end %>
          </div>
        </div>
      </td>
    </tr>
  <% end %>
    </tbody>
  </table>
<% end %>
